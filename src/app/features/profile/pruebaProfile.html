<section>
  <!-- Agregar el navbar aquí -->
  <app-navbar></app-navbar>
  
  <div class="perfil-container">
    <div class="perfil-wrapper">

      <!-- Loading State -->
      <div *ngIf="isLoading()" class="loading-state">
        <div class="loading-spinner"></div>
        <p>Cargando perfil...</p>
      </div>

      <!-- Error State -->
      <div *ngIf="error() && !isLoading()" class="error-state">
        <p>{{ error() }}</p>
        <button (click)="loadProfile()" class="retry-button">Reintentar</button>
      </div>

      <!-- Sección de información del usuario -->
      <div class="usuario-card" *ngIf="user() && !isLoading()">
        <div class="usuario-content">

          <!-- Foto de perfil -->
          <div class="foto-perfil">
            <img [src]="user()?.profileImageUrl" [alt]="user()?.name" 
                 onerror="this.src='https://via.placeholder.com/120x120?text=Usuario'">
          </div>

          <!-- Información básica -->
          <div class="usuario-info">
            <h1 class="usuario-nombre">{{ user()?.name }}</h1>
            <p class="usuario-bio">{{ user()?.description }}</p>

            <!-- Detalles del usuario -->
            <div class="usuario-detalles">
              <div class="detalle-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect width="20" height="16" x="2" y="4" rx="2"/>
                  <path d="m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7"/>
                </svg>
                <span>{{ user()?.email }}</span>
              </div>
              <div class="detalle-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <rect width="18" height="18" x="3" y="4" rx="2" ry="2"/>
                  <line x1="16" x2="16" y1="2" y2="6"/>
                  <line x1="8" x2="8" y1="2" y2="6"/>
                  <line x1="3" x2="21" y1="10" y2="10"/>
                </svg>
                <span>Fecha de nacimiento: {{ user()?.birthDate }}</span>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Sección de publicaciones -->
      <div class="publicaciones-section" *ngIf="user() && !isLoading()">
        <h2 class="publicaciones-titulo">Mis Últimas Publicaciones</h2>

        <!-- Mensaje cuando no hay publicaciones -->
        <div *ngIf="user()?.lastPublicications?.length === 0" class="no-publicaciones">
          <p>Aún no has realizado ninguna publicación</p>
        </div>

        <!-- Lista de publicaciones - Mostrar directamente sin el componente -->
        <div class="publicaciones-lista" *ngIf="user()?.lastPublicications && user()!.lastPublicications.length > 0">
          <div *ngFor="let publication of user()!.lastPublicications" class="publicacion-card">
            <p class="publicacion-contenido">{{ publication.title }}</p>
            <p class="publicacion-contenido">{{ publication.description }}</p>
            
            <!-- Metadata de la publicación -->
            <div class="publicacion-metadata">
              <span class="publicacion-fecha">{{ publication.createdAt | date:'dd/MM/yyyy HH:mm' }}</span>
              <div class="metadata-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/>
                </svg>
                <span>{{ publication.likesCount }}</span>
              </div>
              <div class="metadata-item">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                  <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
                </svg>
                <span>{{ publication.commentsCount }}</span>
              </div>
            </div>
            
            <!-- Comentarios -->
            <div class="comentarios-section" *ngIf="publication.comments && publication.comments.length > 0">
              <h4 class="comentarios-titulo">Comentarios:</h4>
              <div *ngFor="let comentario of publication.comments" class="comentario-item">
                <strong class="comentario-autor">{{ comentario.author }}</strong>
                <p class="comentario-texto">{{ comentario.text }}</p>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>